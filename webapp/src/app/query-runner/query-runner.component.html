<form [formGroup]="queryBuilder" (ngSubmit)="runQuery(throwOnUndefined(buildQuery()))">
	<mat-list>
		<mat-list-item><mat-form-field>
			<mat-label>column</mat-label>
			<mat-select formControlName="columns" (ngModelChange)="ngOnChanges()" multiple>
				<mat-option *ngFor="let col of columns" [value]="col">
					{{col[1]}}
				</mat-option>
			</mat-select>
		</mat-form-field></mat-list-item>

		<mat-list-item><mat-form-field>
			<mat-label>operation</mat-label>
			<mat-select formControlName="operation">
				<mat-option *ngFor="let op of operations" [value]="op">
					{{op}}
				</mat-option>
			</mat-select>
		</mat-form-field></mat-list-item>

		<mat-list-item><button mat-raised-button color="primary" type="submit" [disabled]="!queryBuilder.valid">
			launch
		</button></mat-list-item>
	</mat-list>
</form>

<mat-list>
	<mat-list-item>
		<ng-container *ngIf="state[0] === 'loading'">
			<mat-progress-bar mode="indeterminate"></mat-progress-bar>
		</ng-container>
		<ng-container *ngIf="state[0] === 'errored'">
			Error: {{state[1].message}}
		</ng-container>
		<ng-container *ngIf="state[0] === 'loaded' && state[1].size === 1">
			Result: <ng-container *ngFor="let result of state[1]">
				<ng-container *ngIf="result[0] === 'number'">
					{{result[1] | number}}
				</ng-container>
				<ng-container *ngIf="result[0] === 'date/years'">
					{{result[1] | date:'yyyy'}}
				</ng-container>
				<ng-container *ngIf="result[0] === 'date/days'">
					{{result[1] | date}}
				</ng-container>
				<ng-container *ngIf="result[0] === 'string'">
					{{result[1]}}
				</ng-container>
			</ng-container>
		</ng-container>
		<ng-container *ngIf="state[0] === 'loaded' && state[1].size > 1">
			<app-results-plotter [betas]="state[1].map(extractSecond)"></app-results-plotter>
		</ng-container>
	</mat-list-item>
</mat-list>
